CREATE TABLE DEVELOPER(ID_DEVELOPER INTEGER, NOMBRE VARCHAR2(120), EMAIL VARCHAR2(120), CONSTRAINT PK_ID_DEVELOPER PRIMARY KEY(ID_DEVELOPER));

CREATE TABLE TAREA(ID_TAREA INTEGER, ID_DEVELOPER INTEGER, DESCRIPCION VARCHAR2(500),COMPLETADA CHAR, PORCIENTO_COMPLETADO INTEGER, FECHA DATE, CONSTRAINT PK1_ID_TAREA PRIMARY KEY(ID_TAREA),CONSTRAINT FK1_ID_DEVELOPER FOREIGN KEY(ID_DEVELOPER)REFERENCES DEVELOPER(ID_DEVELOPER));


CREATE SEQUENCE SEC_DEVELOPER
START WITH 1
INCREMENT BY 1
NOMAXVALUE; 

CREATE SEQUENCE SEC_TAREA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;



CREATE OR REPLACE PROCEDURE GUARDAR_DEVELOPER(MY_ID_DEVELOPER OUT INTEGER,MY_NOMBRE IN VARCHAR2,MY_EMAIL IN VARCHAR2)
AS

BEGIN 
SELECT SEC_DEVELOPER.NEXTVAL INTO MY_ID_DEVELOPER FROM DUAL;
INSERT INTO DEVELOPER VALUES (MY_ID_DEVELOPER,MY_NOMBRE, MY_EMAIL);
END;
/

DECLARE
VALOR INTEGER;
BEGIN
GUARDAR_DEVELOPER(VALOR,'BRENDA','BRENDA@GMAIL.COM');
GUARDAR_DEVELOPER(VALOR,' JOSE OMAR','OMAR@YAHOO.COM');
GUARDAR_DEVELOPER(VALOR,'VICTOR','ANGEL@HOTMAIL.COM');
GUARDAR_DEVELOPER(VALOR,'LESLIE','LESLIE@LIVE.COM');
END;
/


SELECT *FROM DEVELOPER;

CREATE OR REPLACE PROCEDURE GUARDAR_TAREA(MY_ID_TAREA OUT INTEGER, MY_ID_DEVELOPER IN INTEGER, MY_DESCRIPCION IN VARCHAR2)
AS
 BEGIN 
SELECT SEC_TAREA.NEXTVAL INTO MY_ID_TAREA FROM DUAL;
INSERT INTO TAREA VALUES (MY_ID_TAREA,MY_ID_DEVELOPER, MY_DESCRIPCION,'N',0,SYSDATE);
END;
/ 


DECLARE 
VALOR INTEGER;
BEGIN
GUARDAR_TAREA(VALOR,1,'CREACION DE PAGINA WEB');
GUARDAR_TAREA(VALOR,2,'CREACION DE TABLAS');
GUARDAR_TAREA(VALOR,3,'PROGRAMAR PROCEDIMIENTOS');
GUARDAR_TAREA(VALOR,4,'PROGRAMAR SERVICIOS WEB');
END;
/

SELECT *FROM TAREA;


CREATE OR REPLACE PROCEDURE ACTUALIZAR_TAREA(MY_ID_TAREA IN INTEGER, MY_ID_DEVELOPER IN INTEGER, MY_PORCIENTO_COMPLETADO IN INTEGER) 
 AS 
 P_RECIENTE INTEGER; 
 P_FINAL INTEGER; 
 BEGIN 
SELECT PORCIENTO_COMPLETADO INTO P_RECIENTE FROM TAREA WHERE ID_TAREA=MY_ID_TAREA; 
 P_RECIENTE := P_RECIENTE + MY_PORCIENTO_COMPLETADO; 
 IF P_FINAL > 100 THEN 
   RAISE_APPLICATION_ERROR(-20003, 'LO SIENTO SOBREPASAS EL PORCENTAJE DE  100%'); 
END IF; 
IF P_FINAL = 100 THEN 
   UPDATE TAREA SET PORCIENTO_COMPLETADO=100, COMPLETADA='S',FECHA=SYSDATE WHERE ID_TAREA=MY_ID_TAREA; 
END IF; 
 UPDATE TAREA SET PORCIENTO_COMPLETADO=P_FINAL, FECHA=SYSDATE WHERE ID_TAREA=MY_ID_TAREA; 
 END;



CREATE OR REPLACE PROCEDURE EFICIENCIA_DEVELOPER(MY_ID_TAREA OUT INTEGER, MY_ID_DEVELOPER IN INTEGER, MY_PORCIENTO_COMPLETADO IN INTEGER)
AS 
VALOR VARCHAR2;
CURSOR CURSOR_TAREA IS FROM SELECT *FROM TAREA WHERE ID_DEVELOPER=MY_ID_DEVELOPER;
BEGIN
VALOR:='LOS ID ENCONTRADOS SON:';
FOR REC IN CURSOR_TAREA LOOP
IF COMPLETADA='N'  THEN 

VALOR:=VALOR||REC.ID_TAREA||',';
END IF;
END LOOP;
END;
/


CREATE OR REPLACE PROCEDURE ANALZIAR_TAREA_INCOMPLETA (MY_ID_DEVELOPER IN INTEGER, MY_ID_TAREA IN INTEGER, MY_PORCIENTO OUT INTEGER, MY_FECHA OUT DATE)
AS
BEGIN
SELECT PORCIENTO_COMPLETADA INTO MY_PORCIENTOE FROM TAREA WHERE ID_TAREA=MY_ID_TAREA AND ID_DEVELOPER=MY_ID_DEVELOPER;
SELECT FECHA INTO MY_FECHA FROM TAREA WHERE ID_TAREA=MY_ID_TAREA AND ID_DEVELOPER=MY_ID_DEVELOPER;
END;


CREATE OR RELACE PROCEDURE EFICENCIA_EMPRESA(MENSAJE OUT FLOAT)
AS 
CURSOR CURSOR_TONTO IS FROM SELECT * FROM TAREA;
SUMANDO INTEGER;
ACUM INTEGER;
BEGIN
SUMANDO:=0;
ACUM:=0;
FOR REC CURSOR_TONTO LOOP
SUMANDO:=SUMANDO+1;
ACUM:=ACUM+REC.PORCIENTO_COMPLETADO;
END LOOP;
MENSAJE:=ACUM/SUMANDO;
END;
/


